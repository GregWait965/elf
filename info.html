<!DOCTYPE html>
<html xml:lang="ru" class="bx-core bx-win bx-no-touch bx-no-retina bx-chrome" lang="ru">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no">
    <title>ПОКАЗАТЕЛИ</title>
        
    
    <link rel="stylesheet" href="info_employee_profile.css" type="text/css">
    <link rel="stylesheet" href="bell.css" type="text/css">
    <link rel="stylesheet" href="info_metrics.css" type="text/css">
    <link rel="stylesheet" href="navi.css" type="text/css" >
    <link rel="stylesheet" href="bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="theme.min.css" type="text/css">
    <link rel="icon" href="logo.ico" type="image/x-icon" >

</head>
<body>
<!-- создание шапки (header) страницы-->
<header>
  <div id="b596" class="block-wrapper block-04-4-one-col-big-with-img">
    <section class="landing-block js-animation landing-block-node-mainimg u-bg-overlay g-pt-30 g-pb-30 slideInDown animated" style="background-color: var(--primary);">
        <div class="u-bg-overlay__inner">
            <div class="landing-block-node-inner container g-max-width-container text-uppercase text-center">
                <h4 class="landing-block-node-title js-animation fadeIn animated g-line-height-1_1 g-font-weight-700 h1 g-color-white">показатели</h2>
            </div>
        </div>
    </section>
</div>
</header>

<main>
<!--дбавление иконки колокольчика -->
<div class="notification-bell">
    <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
        <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/>
    </svg>
</div>

<!-- Добавляем блок для фото сотрудника в левом верхнем углу -->
<div class="employee-profile">
    <div class="photo-container">
        <img id="employeePhoto" src="default-avatar.png" alt="Фото сотрудника">
        <input type="file" id="photoUpload" accept="image/*">
        <label for="photoUpload" class="upload-btn">Загрузить фото</label>
    </div>
    <div class="employee-name">
        <span id="employeeName">Иванов Иван Иванович</span>
    </div>
</div>

<!-- Основные блоки показателей -->
<div class="metrics-container">
    <!-- Блок информации о складе -->
    <div class="warehouse-info">
        <div class="info-item">
            <span>Склад №</span>
            <span id="warehouseNumber">1</span>
        </div>
        <div class="info-item">
            <span>Количество сотрудников:</span>
            <span id="employeeCount">20</span>
        </div>
    </div>

    <!-- Блок отбора товара -->
    <div class="metrics-block">
        <h3>Отбор товара</h3>
        <div id="pickingMetrics" class="metrics-list">
            <!-- Строки гистограммы будут добавляться динамически -->
        </div>
    </div>

    <!-- Блок погрузки -->
    <div class="metrics-block">
        <h3>Погрузка</h3>
        <div id="loadingMetrics" class="metrics-list">
            <!-- Строки гистограммы будут добавляться динамически -->
        </div>
    </div>

    <!-- Общие показатели -->
    <div class="total-metrics">
        <h3>Общие показатели</h3>
        <div class="metrics-value">
            <span>Общий процент:</span>
            <span id="totalPercentage">____</span>
        </div>
    </div>
    <div class="error-metrics">
        <div class="info-item">
            <span>Количество ошибок:</span>
            <span id="errorCount">___</span>
        </div>
        <div class="info-item">
            <span>Процент ошибок:</span>
            <span id="errorPercentage">___</span>
        </div>
    </div>
    </div>
</div>

	
<!-- Добавляем навигационные кнопки -->
	<div class="nav-buttons container">
		<a href="index.html" class="nav-btn">
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z" stroke="white" stroke-width="2"/>
			</svg>
			<span>ПЛАНЕРКА</span>
		</a>
		
		<a href="messages.html" class="nav-btn">
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z" stroke="white" stroke-width="2"/>
			</svg>
			<span>СООБЩЕНИЯ</span>
		</a>
		
		<a href="info.html" class="nav-btn">
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
				<path d="M12 8v8M12 7v.01" stroke="white" stroke-width="2"/>
			</svg>
			<span>ПОКАЗАТЕЛИ РАБОТЫ</span>
		</a>
		
		<a href="safety.html" class="nav-btn">
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="white" stroke-width="2"/>
			</svg>
			<span>ОХРАНА ТРУДА</span>
		</a>
	</div>
	</main>

<hr>
<footer class="bitrix-footer" style="background-color: #4b4848; text-align: center; padding: 10px;">
    <span class="bitrix-footer-text">
        <div class="bitrix-footer-seo">© 2025 ООО "ГК Эльф" ОП г. Новосибирск</div>
    </span>
</footer>

    <script src="info_metrics.js"></script>
    <!-- скрипт Для хранения и синхронизации сообщений между страницами -->
    <script src="main.js"></script>
    <!-- Обработка загрузки колокольчика -->
    <script src="bell.js"></script>
    <!-- Обработка загрузки и валидации фото -->
    <script src="photo_user.js"></script>



<script>
// Вызываем функцию при загрузке страницы
document.addEventListener('DOMContentLoaded', renderTestData);

// _____________________________
function getDataFromAdmin() {
    const data = JSON.parse(localStorage.getItem('employeeData'));
    if (data) {
        updateDashboard(data);
    }
}

function updateDashboard(data) {
    document.getElementById('employeeCount').textContent = data.length;
    updateHistograms(data);
    updateTotalMetrics(data);
}

// Обновляем данные каждые 30 секунд
document.addEventListener('DOMContentLoaded', () => {
    getDataFromAdmin();
    setInterval(getDataFromAdmin, 30000);
});
// __________

// Функция загрузки и обработки данных из admin.html
// Функция загрузки данных с использованием fetch
function fetchDataFromAdmin() {
    fetch('admin.html')
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const table = doc.querySelector('#employeeTable');
            
            if (table) {
                const data = parseTableData(table);
                updateDashboard(data);
            } else {
                // Временно используем тестовые данные
                updateDashboard(testData);
            }
        })
        .catch(error => {
            console.log('Используем тестовые данные:', error);
            updateDashboard(testData);
        });
}

// Функция обновления всех показателей на странице
function updateDashboard(data) {
    // Обновляем количество сотрудников
    document.getElementById('employeeCount').textContent = data.length;
    
    // Обновляем гистограммы
    updateHistograms(data);
    
    // Обновляем общие показатели
    updateTotalMetrics(data);
}

// Функция обновления гистограмм
function updateHistograms(data) {
    const pickingMetrics = document.getElementById('pickingMetrics');
    const loadingMetrics = document.getElementById('loadingMetrics');
    
    const maxPicking = Math.max(...data.map(d => d.picking));
    const maxLoading = Math.max(...data.map(d => d.loading));
    
    pickingMetrics.innerHTML = '';
    loadingMetrics.innerHTML = '';
    
    data.forEach(employee => {
        pickingMetrics.innerHTML += createMetricRow(employee.picking, maxPicking, employee.name);
        loadingMetrics.innerHTML += createMetricRow(employee.loading, maxLoading, employee.name);
    });
}




// Функция создания строки гистограммы
function createMetricRow(value, maxValue, name) {
    const percentage = (value / maxValue) * 100;
    return `
        <div class="metric-row">
            <div class="metric-value">${value}</div>
            <div class="metric-bar">
                <div class="metric-bar-fill" style="width: ${percentage}%"></div>
            </div>
            <div class="metric-name">${name}</div>
        </div>
    `;
}

// Функция обновления общих показателей
function updateTotalMetrics(data) {
    const totalPercentage = data.reduce((sum, emp) => sum + emp.percentage, 0) / data.length;
    document.getElementById('totalPercentage').textContent = `${totalPercentage.toFixed(1)}%`;
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', () => {
    fetchDataFromAdmin();
    setInterval(fetchDataFromAdmin, 300000); // Обновление каждые 5 минут
});
// Загрузка сохраненных данных при старте
document.addEventListener('DOMContentLoaded', function() {
    // Загрузка сохраненного фото
    const savedPhoto = localStorage.getItem('employeePhoto');
    if (savedPhoto) {
        document.getElementById('employeePhoto').src = savedPhoto;
    }

    // Первичная загрузка данных
    fetchDataFromAdmin();
});

// Обновление гистограмм
function updateHistograms(data) {
    const pickingMetrics = document.getElementById('pickingMetrics');
    const loadingMetrics = document.getElementById('loadingMetrics');
    
    // Очищаем текущие данные
    pickingMetrics.innerHTML = '';
    loadingMetrics.innerHTML = '';

    // Получаем максимальные значения для масштабирования
    const maxPicking = Math.max(...Array.from(data.querySelectorAll('[data-picking]'))
        .map(el => parseInt(el.getAttribute('data-picking'))));
    const maxLoading = Math.max(...Array.from(data.querySelectorAll('[data-loading]'))
        .map(el => parseInt(el.getAttribute('data-loading'))));

    // Заполняем гистограммы
    data.querySelectorAll('tr').forEach(row => {
        const name = row.getAttribute('data-name');
        const picking = parseInt(row.getAttribute('data-picking'));
        const loading = parseInt(row.getAttribute('data-loading'));

        pickingMetrics.innerHTML += createMetricRow(picking, maxPicking, name);
        loadingMetrics.innerHTML += createMetricRow(loading, maxLoading, name);
    });
}
</script>
    
    
    


    <script>

        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            loadTasks();
            initNewsFeed();
            initTaskSystem();
        });
        
        
        function updateCurrentDate() {
            const dateElement = document.getElementById('currentDate');
            const now = new Date();
            dateElement.textContent = now.toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        </script>
</body>
</html>